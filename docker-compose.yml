version: '3.8'

services:
  postgres:
    image: postgres:14
    container_name: zenvault-postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 988204
      POSTGRES_DB: zenvault
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: zenvault-backend
    depends_on:
      - postgres
    environment:
      - PORT=3000
      - NODE_ENV=development
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_USER=postgres
      - DB_PASSWORD=988204
      - DB_NAME=zenvault
      - JWT_SECRET=2a2d4969104051aaed40d25853b27f14cf4248bde9fae1f0b25b06babeb1bc3fbd12601ecf2dbc655933434d62872b87f7781e70d13205f6fd74abaeebe4e03183b0d3cac086161e84c4159e23104f6383daaee9d2301a56278d58426e98d4edfc52c6186b71432a1ca4d008750f3c5af9dfa73706a2b66e9f9edc1813b06577a2269367cc67dce202fffab919d3b85c6eddef31477a1898e40478faf2b6c7e666f0b291b2e3efb0a733aac8d63699352661c924283b635f776eea1d61521ac7ac6191983d37823914b4a9002ee6803a2fc9ab8102970e88acc61382c0e1a41f9758f9c8da672b65d0299b393d6c20002ad0b3defb0104bc66f32dd186fc17ab07ea271ef86ea85ce67812c6a4fc1684d6cab832f2083c2ec3c776a77d709e940b5e28a25709bd977db1469868abd42b22a8089ec1695afe38f53a8b97f411b3905cb4d3fbd1e2f789c4ca3283c16289af60f400608c9e8935de2854d5cfbc7cb3d6f712da6f1b5920646f91108cca825722c34dcb1b58933f6d0cdcf7272aede2a3adb957b4b8b562429a49e6de5805ad97b54dee6aed5aec7fef26a8e934473b1a45200c97f15ceab20dadd838e9f0dd509a2e4e1cf9689e88deb3c44ddd3202d34e0836eebd9db39ecb515c8194ea24746fb298ec3400d87fee351831a4e585b85e59b2c00bcf22827e489ea22328d3506b61ee29c7a72272f54b7e3417f7
      - JWT_EXPIRES_IN=24h
      - CLERK_SECRET_KEY=pk_test_ZXhvdGljLWliZXgtNDEuY2xlcmsuYWNjb3VudHMuZGV2JA
      - UPLOAD_DIR=/app/uploads
    ports:
      - "3000:3000"
    volumes:
      - ./backend/uploads:/app/uploads
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: zenvault-frontend
    depends_on:
      - backend
    environment:
      - VITE_API_URL=http://localhost:3000
      - VITE_CLERK_PUBLISHABLE_KEY=pk_test_ZXhvdGljLWliZXgtNDEuY2xlcmsuYWNjb3VudHMuZGV2JA
    ports:
      - "8080:8080"
    restart: unless-stopped

volumes:
  postgres_data: